# ä¼šè®®å®¤ç®¡ç†ç³»ç»Ÿ - SQLæ–‡ä»¶å¤¹è¯´æ˜

## ğŸ“ æ–‡ä»¶å¤¹ç»“æ„

```
sql/
â”œâ”€â”€ 00_reset_database.sql          # æ•°æ®åº“é‡ç½®è„šæœ¬ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
â”œâ”€â”€ 01_create_tables.sql           # æ•°æ®åº“è¡¨ç»“æ„åˆ›å»º
â”œâ”€â”€ 02_insert_base_data.sql        # åŸºç¡€æ•°æ®æ’å…¥
â”œâ”€â”€ 03_create_compatibility_views.sql # å…¼å®¹æ€§è§†å›¾ï¼ˆè§£å†³å†å²é—®é¢˜ï¼‰
â”œâ”€â”€ 04_maintenance_operations.sql  # æ•°æ®åº“ç»´æŠ¤å’Œä¼˜åŒ–è„šæœ¬
â”œâ”€â”€ 05_security_hardening.sql      # æ•°æ®åº“å®‰å…¨åŠ å›ºè„šæœ¬
â”œâ”€â”€ 06_database_tests.sql          # æ•°æ®åº“åŠŸèƒ½æµ‹è¯•è„šæœ¬
â”œâ”€â”€ 99_full_install.sql            # ä¸€é”®å®Œæ•´å®‰è£…è„šæœ¬
â”œâ”€â”€ hotfix_duplicate_columns.sql   # çƒ­ä¿®å¤ï¼šé‡å¤åˆ—é—®é¢˜ä¿®å¤
â”œâ”€â”€ run_sql.sh                     # SQLæ‰§è¡Œè¾…åŠ©è„šæœ¬
â””â”€â”€ README.md                      # æœ¬è¯´æ˜æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨æ‰§è¡Œè„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# è¿›å…¥SQLç›®å½•
cd sql

# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
./run_sql.sh --help

# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨è„šæœ¬
./run_sql.sh --list

# ä¸€é”®å®‰è£…
./run_sql.sh --install

# è¿è¡Œæµ‹è¯•
./run_sql.sh --test

# è¿è¡Œç»´æŠ¤
./run_sql.sh --maintain

# å®‰å…¨åŠ å›º
./run_sql.sh --secure
```

### æ–¹å¼äºŒï¼šä¸€é”®å®‰è£…ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰
```bash
mysql -u root -p < sql/99_full_install.sql
```

### æ–¹å¼ä¸‰ï¼šåˆ†æ­¥å®‰è£…ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰
```bash
# 1. é‡ç½®æ•°æ®åº“ï¼ˆå¯é€‰ï¼Œä»…åœ¨éœ€è¦æ¸…ç©ºæ—¶ä½¿ç”¨ï¼‰
mysql -u root -p < sql/00_reset_database.sql

# 2. åˆ›å»ºè¡¨ç»“æ„
mysql -u root -p < sql/01_create_tables.sql

# 3. æ’å…¥åŸºç¡€æ•°æ®
mysql -u root -p < sql/02_insert_base_data.sql

# 4. åˆ›å»ºå…¼å®¹æ€§è§†å›¾ï¼ˆè§£å†³å†å²æŸ¥è¯¢é—®é¢˜ï¼‰
mysql -u root -p < sql/03_create_compatibility_views.sql

# 5. è¿è¡Œæ•°æ®åº“æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
mysql -u root -p < sql/06_database_tests.sql
```

### æ–¹å¼å››ï¼šé«˜çº§ç»´æŠ¤æ“ä½œ
```bash
# æ•°æ®åº“ç»´æŠ¤å’Œä¼˜åŒ–
mysql -u root -p < sql/04_maintenance_operations.sql

# å®‰å…¨åŠ å›ºï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
mysql -u root -p < sql/05_security_hardening.sql
```

## ğŸ“‹ æ–‡ä»¶è¯¦ç»†è¯´æ˜

### 00_reset_database.sql
- **ä½œç”¨**: å®Œå…¨é‡ç½®æ•°æ®åº“ï¼Œåˆ é™¤æ‰€æœ‰æ•°æ®å’Œè¡¨ç»“æ„
- **è­¦å‘Š**: âš ï¸ æ­¤æ“ä½œä¸å¯é€†ï¼Œä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼
- **ä½¿ç”¨åœºæ™¯**: 
  - å…¨æ–°å®‰è£…
  - å¼€å‘ç¯å¢ƒé‡ç½®
  - æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–

### 01_create_tables.sql
- **ä½œç”¨**: åˆ›å»ºå®Œæ•´çš„æ•°æ®åº“è¡¨ç»“æ„
- **åŒ…å«è¡¨**:
  - Userï¼ˆç”¨æˆ·ä¿¡æ¯ï¼‰
  - MeetingRoomï¼ˆä¼šè®®å®¤ä¿¡æ¯ï¼‰
  - Bookingï¼ˆé¢„è®¢ä¿¡æ¯ï¼‰
  - Equipmentï¼ˆè®¾å¤‡ä¿¡æ¯ï¼‰
  - Logï¼ˆç³»ç»Ÿæ—¥å¿—ï¼‰
  - Notificationï¼ˆé€šçŸ¥æ¶ˆæ¯ï¼‰
  - Maintenanceï¼ˆç»´æŠ¤è®°å½•ï¼‰
  - MeetingMaterialsï¼ˆä¼šè®®èµ„æ–™ï¼‰
- **ç‰¹è‰²**:
  - å®Œæ•´çš„ç´¢å¼•ä¼˜åŒ–
  - å¤–é”®çº¦æŸä¿è¯æ•°æ®å®Œæ•´æ€§
  - è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜

### 02_insert_base_data.sql
- **ä½œç”¨**: æ’å…¥ç³»ç»Ÿè¿è¡Œæ‰€éœ€çš„åŸºç¡€æ•°æ®
- **åŒ…å«æ•°æ®**:
  - ç®¡ç†å‘˜è´¦æˆ·ï¼ˆadmin, liansifanï¼‰
  - æµ‹è¯•ç”¨æˆ·è´¦æˆ·
  - 10ä¸ªä¼šè®®å®¤ï¼ˆåŒ…å«çº¿ä¸Šå’Œçº¿ä¸‹ï¼‰
  - è®¾å¤‡é…ç½®ä¿¡æ¯
  - ç¤ºä¾‹é¢„è®¢è®°å½•
  - ç»´æŠ¤è®¡åˆ’è®°å½•
  - ç³»ç»Ÿæ—¥å¿—ç¤ºä¾‹
  - é€šçŸ¥æ¶ˆæ¯ç¤ºä¾‹
- **ä¿®å¤å†…å®¹**:
  - âœ… ä¿®å¤äº†é¢„è®¢æ—¶é—´é€»è¾‘é”™è¯¯
  - âœ… ä¿®æ­£äº†å‚ä¼šäººæ•°ä¸æˆ¿é—´å®¹é‡ä¸ç¬¦é—®é¢˜

### 03_create_compatibility_views.sql
- **ä½œç”¨**: è§£å†³å†å²æ•°æ®åº“æŸ¥è¯¢å…¼å®¹æ€§é—®é¢˜
- **è§£å†³çš„é—®é¢˜**:
  1. æŸ¥è¯¢ä½¿ç”¨`MaintenanceID`ä½†è¡¨ä½¿ç”¨`ID`ä½œä¸ºä¸»é”®
  2. æŸ¥è¯¢ä½¿ç”¨`Users`è¡¨åä½†å®é™…è¡¨åæ˜¯`User`
  3. æŸ¥è¯¢ä½¿ç”¨`Username`åˆ—åä½†å®é™…åˆ—åæ˜¯`UserName`
- **åˆ›å»ºçš„è§†å›¾**:
  - `MaintenanceView`: å°†`ID`æ˜ å°„ä¸º`MaintenanceID`
  - `Users`: å°†`User`è¡¨æ˜ å°„ä¸º`Users`è§†å›¾ï¼Œ`UserName`æ˜ å°„ä¸º`Username`

### 04_maintenance_operations.sql
- **ä½œç”¨**: æ•°æ®åº“æ—¥å¸¸ç»´æŠ¤ã€æ€§èƒ½ä¼˜åŒ–å’Œæ•°æ®æ¸…ç†
- **åŒ…å«åŠŸèƒ½**:
  - æ•°æ®åº“å¥åº·æ£€æŸ¥
  - ç´¢å¼•ä½¿ç”¨æƒ…å†µåˆ†æ
  - è¿‡æœŸæ•°æ®æ¸…ç†
  - æ€§èƒ½ä¼˜åŒ–æ“ä½œ
  - æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
  - ç»Ÿè®¡ä¿¡æ¯æ›´æ–°
  - ç›‘æ§æŸ¥è¯¢å’ŒæŠ¥å‘Š
- **ä½¿ç”¨åœºæ™¯**: å®šæœŸç»´æŠ¤ã€æ€§èƒ½ä¼˜åŒ–

### 05_security_hardening.sql
- **ä½œç”¨**: å¢å¼ºæ•°æ®åº“å®‰å…¨æ€§ï¼Œåˆ›å»ºä¸“ç”¨ç”¨æˆ·å’Œæƒé™æ§åˆ¶
- **åŒ…å«åŠŸèƒ½**:
  - åˆ›å»ºä¸“ç”¨æ•°æ®åº“ç”¨æˆ·
  - æƒé™åˆ†é…å’Œç®¡ç†
  - å®‰å…¨å®¡è®¡è¡¨åˆ›å»º
  - å¯†ç å®‰å…¨æ£€æŸ¥
  - å®‰å…¨ç›‘æ§è§†å›¾
  - å®‰å…¨ç­–ç•¥è§¦å‘å™¨
- **ä½¿ç”¨åœºæ™¯**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€å®‰å…¨åŠ å›º

### 06_database_tests.sql
- **ä½œç”¨**: å…¨é¢æµ‹è¯•æ•°æ®åº“åŠŸèƒ½å’Œæ€§èƒ½
- **åŒ…å«æµ‹è¯•**:
  - åŸºç¡€è¿æ¥å’Œæƒé™æµ‹è¯•
  - è¡¨ç»“æ„å®Œæ•´æ€§æµ‹è¯•
  - å¤–é”®çº¦æŸæµ‹è¯•
  - ç´¢å¼•å®Œæ•´æ€§æµ‹è¯•
  - æ•°æ®å®Œæ•´æ€§æµ‹è¯•
  - å…¼å®¹æ€§è§†å›¾æµ‹è¯•
  - æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
  - CRUDæ“ä½œæµ‹è¯•
  - äº‹åŠ¡æµ‹è¯•
  - æ€§èƒ½åŸºå‡†æµ‹è¯•
- **ä½¿ç”¨åœºæ™¯**: ç³»ç»ŸéªŒè¯ã€æ•…éšœè¯Šæ–­

### 99_full_install.sql
- **ä½œç”¨**: ä¸€é”®å®Œæ•´å®‰è£…æ•´ä¸ªæ•°æ®åº“ç³»ç»Ÿ
- **åŒ…å«å†…å®¹**: 
  - æ‰€æœ‰ä¸Šè¿°è„šæœ¬çš„å®Œæ•´åˆå¹¶ç‰ˆæœ¬
  - å®‰è£…è¿›åº¦æç¤º
  - ç³»ç»Ÿä¿¡æ¯æ˜¾ç¤º
  - é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸ› ï¸ ç»´æŠ¤è¯´æ˜

### æ•°æ®åº“ç‰ˆæœ¬è¦æ±‚
- MySQL 5.7+
- MariaDB 10.2+

### å­—ç¬¦é›†è®¾ç½®
- æ•°æ®åº“å­—ç¬¦é›†: `utf8mb4`
- æ’åºè§„åˆ™: `utf8mb4_unicode_ci`

### æ€§èƒ½ä¼˜åŒ–
æ‰€æœ‰è„šæœ¬å·²åŒ…å«ä»¥ä¸‹ä¼˜åŒ–ï¼š
- ä¸»é”®å’Œå¤–é”®ç´¢å¼•
- å¸¸ç”¨æŸ¥è¯¢å­—æ®µç´¢å¼•
- é€‚å½“çš„æ•°æ®ç±»å‹é€‰æ‹©

### å®‰å…¨è€ƒè™‘
- é»˜è®¤ç®¡ç†å‘˜å¯†ç ä¸ºMD5åŠ å¯†çš„`123456`
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰è¯·ä¿®æ”¹é»˜è®¤å¯†ç 
- å»ºè®®å¯ç”¨SSLè¿æ¥

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æƒé™é”™è¯¯**
   ```bash
   # ç¡®ä¿MySQLç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™
   GRANT ALL PRIVILEGES ON test_meeting_rooms.* TO 'username'@'localhost';
   FLUSH PRIVILEGES;
   ```

2. **å­—ç¬¦é›†é—®é¢˜**
   ```sql
   # æ£€æŸ¥å­—ç¬¦é›†è®¾ç½®
   SHOW VARIABLES LIKE 'character_set%';
   ```

3. **å…¼å®¹æ€§è§†å›¾é—®é¢˜**
   ```sql
   # éªŒè¯è§†å›¾åˆ›å»ºæˆåŠŸ
   SHOW FULL TABLES WHERE Table_type = 'VIEW';
   ```

### éªŒè¯å®‰è£…

å®‰è£…å®Œæˆåï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹æŸ¥è¯¢éªŒè¯ï¼š

```sql
-- æ£€æŸ¥è¡¨ç»“æ„
SHOW TABLES;

-- æ£€æŸ¥æ•°æ®
SELECT COUNT(*) FROM User;
SELECT COUNT(*) FROM MeetingRoom;
SELECT COUNT(*) FROM Booking;

-- æµ‹è¯•å…¼å®¹æ€§è§†å›¾
SELECT MaintenanceID FROM MaintenanceView LIMIT 1;
SELECT Username FROM Users LIMIT 1;
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. MySQLæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. ç”¨æˆ·æƒé™æ˜¯å¦è¶³å¤Ÿ
3. å­—ç¬¦é›†è®¾ç½®æ˜¯å¦æ­£ç¡®
4. ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³

---

**åˆ›å»ºæ—¶é—´**: 2025å¹´6æœˆ9æ—¥  
**ç‰ˆæœ¬**: 1.0  
**ç»´æŠ¤è€…**: ä¼šè®®å®¤ç®¡ç†ç³»ç»Ÿå¼€å‘å›¢é˜Ÿ
